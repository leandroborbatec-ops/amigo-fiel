<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amigo Fiel SOS</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0084ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="amigofiel.png">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f0f2f5; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Header e Bot√£o de Emerg√™ncia */
        .header { background-color: #0084ff; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-ajuda-agora { background-color: #ff0000; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-weight: bold; font-size: 12px; text-decoration: none; text-align: center; line-height: 1.2; }
        
        /* √Årea de Chat */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .mensagem { max-width: 85%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.4; position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .bot { background-color: white; align-self: flex-start; border-bottom-left-radius: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); color: #333; }
        .user { background-color: #0084ff; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }

        /* Container de Emojis e Op√ß√µes */
        .sentimentos-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; justify-content: center; }
        .opcoes-container { display: flex; flex-direction: column; gap: 10px; padding: 0 20px; margin-bottom: 10px; }
        
        .btn-emoji { background: #f8f9fa; border: 1px solid #dee2e6; padding: 8px 12px; border-radius: 15px; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .btn-emoji:active { background: #e2e6ea; transform: scale(0.95); }
        
        .btn-opcao { background-color: #0084ff; color: white; border: none; padding: 12px; border-radius: 25px; font-weight: 500; cursor: pointer; width: 100%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* Rodap√©: Input e Avisos */
        .footer-container { background: white; padding: 10px; border-top: 1px solid #eee; }
        .input-area { display: flex; gap: 10px; align-items: center; max-width: 600px; margin: 0 auto; padding-bottom: 5px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 16px; }
        .btn-enviar { background-color: #0084ff; border: none; width: 45px; height: 45px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .disclaimer { font-size: 10px; color: #888; text-align: center; padding: 5px 10px; line-height: 1.2; }
        .btn-doar { background-color: #28a745; color: white; border: none; padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: bold; margin: 5px auto; display: block; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h2 style="font-size: 18px;">SOS - Amigo Fiel</h2>
        </div>
        <a href="tel:188" class="btn-ajuda-agora">
            AJUDA AGORA<br><span style="font-size: 10px; font-weight: normal;">Ligar CVV 188</span>
        </a>
    </div>

    <div id="chat-container">
        <div class="mensagem bot">
            Ol√°! Eu sou o Amigo Fiel. Estou aqui para te ouvir sem julgamentos. 
            <br><br><b>Como voc√™ est√° se sentindo hoje? Pode desabafar...</b>
            
            <div class="sentimentos-container">
                <button class="btn-emoji" onclick="enviarSentimento('üòä', 'Estou me sentindo bem e grato a Deus hoje.')">üòä Bem</button>
                <button class="btn-emoji" onclick="enviarSentimento('üòê', 'Estou me sentindo normal, apenas quero conversar.')">üòê Normal</button>
                <button class="btn-emoji" onclick="enviarSentimento('üòî', 'Estou me sentindo triste e precisando de consolo.')">üòî Triste</button>
                <button class="btn-emoji" onclick="enviarSentimento('üò∞', 'Estou me sentindo muito ansioso e com o cora√ß√£o apertado.')">üò∞ Ansioso</button>
                <button class="btn-emoji" onclick="enviarSentimento('üò°', 'Estou me sentindo bravo e com muita raiva de algo.')">üò° Bravo</button>
            </div>
        </div>
    </div>

    <div class="opcoes-container">
        <button class="btn-opcao" onclick="enviarOpcao('Gostaria de conhecer uma c√©lula?')">Gostaria de conhecer uma c√©lula?</button>
        <button class="btn-opcao" onclick="enviarOpcao('Preciso de um conselho b√≠blico agora')">Preciso de um conselho b√≠blico agora</button>
    </div>

    <div class="footer-container">
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Escreva aqui..." onkeypress="verificarEnter(event)">
            <button class="btn-enviar" onclick="enviarMensagem()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
        
        <p class="disclaimer">Apoio b√≠blico Batista. Este servi√ßo n√£o substitui psic√≥logos ou m√©dicos.</p>
        <button class="btn-doar" onclick="window.open('SEU_LINK_DE_PIX_OU_DOACAO', '_blank')">‚ù§ Manter este projeto vivo</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');

        function adicionarMensagem(texto, tipo) {
            const div = document.createElement('div');
            div.className = `mensagem ${tipo}`;
            div.innerText = texto;
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function verificarEnter(event) {
            if (event.key === 'Enter') enviarMensagem();
        }

        function enviarSentimento(emoji, textoCompleto) {
            // Mostra apenas o emoji e uma vers√£o curta no chat para o usu√°rio
            adicionarMensagem(emoji + " " + textoCompleto, 'user');
            processarRespostaIA(textoCompleto);
        }

        function enviarOpcao(texto) {
            adicionarMensagem(texto, 'user');
            processarRespostaIA(texto);
        }

        function enviarMensagem() {
            const texto = userInput.value.trim();
            if (texto === "") return;
            adicionarMensagem(texto, 'user');
            userInput.value = "";
            processarRespostaIA(texto);
        }

        async function processarRespostaIA(mensagemUsuario) {
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mensagem: mensagemUsuario })
                });
                const data = await response.json();
                adicionarMensagem(data.resposta, 'bot');
            } catch (e) {
                adicionarMensagem("Estou processando seu desabafo com carinho. Minha conex√£o est√° lenta, mas j√° te respondo biblicamente.", "bot");
            }
        }
    </script>
</body>
</html>
